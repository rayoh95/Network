#### 네트워크 계층의 프로토콜



##### 네트워크 계층 역할

* 연결 유형
  * `Connection - oriented` : 가상 회선을 만들어내는 과정
    * 송수신을 위한 연결통로를 만들고 데이터 전송(패킷을 보낸다.)
    * 각 패킷에 대해 라우터는 이미 경로를 알고있기 때문에 다시 계산할 필요가 없다.
    * 패킷이 모두 전달된 후 연결은 종료
  * `Connectionless` : 연결이 안 되어있는 것이 아닌, 패킷을 보내는데 그 후 신경을 쓰지 않는다.
    * 각 패킷은 서로 독립적으로 취급하며 아무 관계가 없다.
    * 같은 목적지로 전달됨에도 불구하고 서로 다른 경로를 통하여 전달 될 수 있다.
    * `IP 는 비연결형 프로토콜` : 비연결형 서비스를 제공

* 네트워크 구성 요소
  * Network service
    * LAN 은 connectionless service 를 제공하고 WAN 은 connection-oriented service 를 제공하는데, LAN 과 WAN 이 서로 연결되는 인터넷에서는 서비스를 연결형으로 제공할 것인지, 비연결형으로 제공할 것인지 결정해야 한다.
  * `Protocol`
    * 인터넷에는 각 서브 넷의 고유한 프로토콜을 유지하면서도 서로 통신할 수 있도록 해주는 연결 방법이 필요
  * Addressing
    * 각 sub network 마다 사용하는 주소 구조가 다르므로 기존의 주소 체계는 인터넷에서는 사용 곤한하다.
    * 제 3의 공통 주소 구조 필요
      * `Ethernet`을 통해 인터넷에 접속된 노드 : 48 bit 의 Ethernet Hardware 주소 + 32 bit IP 주소
  * Routing
    * 목적지까지 정확하게 패킷을 전달할 수 있게 해주는 것.
  * Quality of Service (QoS)
    * 어느 정도 프레임이 손실되더라도 시간차에 의해 지장을 주지 않는 선에서 데이터가 전달되어야 한다.
    * 오디오, 비디오 등 멀티미디어서비스
    * 원하는 지연시간 한계, 비용 한계, 우선순위, 보안 수준, 허용 에러율 등 고려해서 보내는 방식.



##### 네트워크 계층의 책임

`Host-to-host path` - 종단 간의 전달 책임

* 여러 링크를 통한 전달 문제 해결

* 호스트 대 호스트 전송 책임

* `라우터` 또는 교환기를 통한 패킷 `라우팅` 책임



##### `출발노드`

1. transport layer 에서 내려온다.
2. Packetizer 를 만나 패킷화한다. -> IP packet 에 헤더를 붙인다.
3. Processing module 에 들어가서 여러 옵션을 추가해 패킷을 구성 후 
4. Routing module 진입. 해당 Routing table 에 있는 형태로 패킷을 출발시킨다. (라우터마나 라우팅 테이블을 만드는 방식이 따로 존재)
5. Fragmentation module 로 진입해 패킷을 쪼갠다.
6. 아래의 datalink layer 로 보낸다.



* `Packetizr Module`
  * 상위 계층으로 부터 받은 데이터와 목적지 IP 주소를 받은 뒤 IP 헤터를 추가해 IP 데이터그램 내에 캡슐화 한다.
* `처리 모듈`
  * IP 패키지의 핵심. 목적지 주소를 확인.
* `중간 노드`
  * data link layer 에서 올라왔을 때, Processing module 로 보내고 Routing module 로 목적지를 파악하고 Fragmentation module 이 작동해 패킷 쪼갠다.
* `단편화 모듈 (Fragmentation module)`
  * `MTU (Max Translate mid)` 테이블을 참조. MTU 번호를 찾아 데이터그렘의 길이가 더 크다면 단편화, 각 단편에 헤더를 붙인 후 내려보낸다.
* `목적지 노드`
  * data link layer 에서 데이터를 받아 Processing module -> Error checker -> Reassembly module 로 쪼개진 정보를 하나로 조립 후 transport layer 로 보낸다.
  * 타임아웃이 만료 되었음에도 단편이 전부 오지 않는다면 조립하지 않고 받은 데이터를 폐기.



##### `주소지정`

클래스 구분 분류

* Class A	:	0.......	.......	.......	.......		`First byte`: 0 to 127
* Class B	:	10......	.......	.......	.......		`First byte`: 128 to 191
* Class C	:	110.......	.......	.......	.......		`First byte`: 192 to 223
* Class D	:	1110.......	.......	.......	.......		`First byte`: 224 to 239
* Class E	:	1111.......	.......	.......	.......		`First byte`: 240 to 255

각 클래스는 고정된 크기의 블록을 가지고 있다. 어느 네트워크에 할당할 것인지 필요에 따라 클래스를 선택하면 된다.



`클래스 A`

* 128 개의 블록 (구성가능한 네트워크 수)
* 블록 당 16,777,216 개의 주소 (대체적으로 낭비가 심하다. 상당 수 host 를 사용하지 않기 때문)

`클래스 B`

* 16,368 개의 블록
* 블록 당 65,536 개의 주소
* 네트워크에 만여 개 정도의 호스트나 라우터를 사용하는 중형 기관을 위해 설계 (여전히 많은 주소 낭비)

`클래스 C`

* 2,097,152 블록, 256 개 사설 블록
* 2,096,896 개 블록 할당
* 블록 당 256 개의 주소로 요구량보다 약간 적을 수 있다.

